apply plugin: 'com.android.library'
apply plugin: 'com.github.ben-manes.versions'
apply plugin: 'com.github.panpf.bintray-publish'
//apply plugin: 'jacoco'

apply from: '../gradle/dependencies.gradle'

// CI
def isCi = "true" == System.getenv("CI")
def preDexEnabled = "true" == System.getProperty("pre-dex", "true")

android {
  compileSdkVersion 30
  buildToolsVersion '30.0.2'

  defaultConfig {
    minSdkVersion 26
    targetSdkVersion 30
    versionCode 1
    versionName "1.0"

    //testInstrumentationRunner "android.support.test.runner.AndroidJUnitRunner"

  }

  buildTypes {
    debug {
      testCoverageEnabled true
    }
    release {
      minifyEnabled false
      proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
    }
  }

  dexOptions {
    // Skip pre-dexing when running on CI or when disabled via -Dpre-dex=false.
    preDexLibraries = preDexEnabled && !isCi
  }

  compileOptions {
    sourceCompatibility = JavaVersion.VERSION_1_8
    targetCompatibility = JavaVersion.VERSION_1_8
  }

  testOptions {
    unitTests.all {
      jacoco {
        includeNoLocationClasses = true
      }
    }
  }
}

dependencies {
  api "androidx.appcompat:appcompat:${deps.appcompat}"

  //noinspection AnnotationProcessorOnCompilePath
  compileOnly "org.projectlombok:lombok:${deps.lombok}"
  annotationProcessor "org.projectlombok:lombok:${deps.lombok}"

  //android room
  implementation "androidx.room:room-runtime:${deps.room}"
  implementation "androidx.room:room-rxjava2:${deps.room}"
  annotationProcessor "androidx.room:room-compiler:${deps.room}"

  //RxJava
  implementation 'io.reactivex.rxjava2:rxjava:2.2.20'
  implementation 'io.reactivex.rxjava2:rxandroid:2.1.1'

  androidTestImplementation("androidx.appcompat:appcompat:${deps.appcompat}", {
    exclude group: 'androidx.annotation', module: 'annotation'
  })

  testImplementation "junit:junit:${deps.junit}"
  testImplementation "org.robolectric:robolectric:${deps.robolectric}"
}

publish {
  userOrg = 'pecet86'
  artifactId = 'historian-core'
  desc = "a simple logger which saves logs to SQLite, to get better understanding of user's environment"

  def metadata = project.rootProject.ext.metadata
  groupId = metadata.groupId
  publishVersion = metadata.version
  website = metadata.website
  repository = metadata.repository
  licences = metadata.licences
}

// A list of directories which should be included in coverage report
//def coverageSourceDirs = ['src/main/java']
// A list of files which should be excluded from coverage report since they are generated and/or framework code
//def coverageExcludeFiles = ['**/R.class', '**/R$*.class', '**/com/android/**/*.*']

/*
task jacocoTestReportDebug(type: JacocoReport, dependsOn: ['testDebugUnitTest']) {
  group = "Reporting"
  description = "Generate Jacoco coverage reports after running tests."
  reports {
    xml.enabled true
    html.enabled true
    csv.enabled false
    xml.destination "${buildDir}/reports/jacoco/test/jacocoTestReportDebug.xml"
    html.destination "${buildDir}/reports/coverage/debug"
    classDirectories = files(
        fileTree(
            dir: "${buildDir}/intermediates/classes/debug",
            exclude: coverageExcludeFiles))
  }
  sourceDirectories = files(coverageSourceDirs)
  executionData = files "${buildDir}/jacoco/testDebugUnitTest.exec"

  doLast {
    println "jacoco xml report has been generated to file://${buildDir}/reports/jacoco/test/jacocoTestReportDebug.xml"
    println "jacoco html report has been generated to file://${reports.html.destination}/index.html"
  }
}
*/